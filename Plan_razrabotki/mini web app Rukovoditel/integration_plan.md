# План интеграции Мини-приложения "Руководитель" (Manager App)

## 1. Общий обзор
Интеграция отдельного модуля для руководителей в основную экосистему приложения. Модуль должен быть доступен только пользователям с правами менеджера/администратора и обеспечивать бесшовный переход из основного меню.

## 2. Безопасность и Доступ (RBAC)

### Backend
*   **Роли**: Убедиться, что роль `MANAGER` существует в системе (или использовать `ADMIN`).
*   **Middleware**: Настроить защиту API эндпоинтов `/api/analytics/*`, разрешив доступ только для ролей `MANAGER` и `ADMIN`. `FOREMAN` (Прораб) не должен иметь к ним доступа.

### Frontend
*   **Protected Routes**: Использовать компонент защиты маршрутов (например, `RequireAuth` или `RoleGuard`).
    *   Маршрут `/miniapp/manager/*` должен перенаправлять на страницу "Доступ запрещен" или Главную, если у пользователя нет нужной роли.

## 3. Навигация и Меню

### Telegram Bot WebApp
*   **Меню Бота**: Добавить отдельную кнопку "Кабинет Руководителя" в меню бота, которая ведет по прямой ссылке: `https://.../miniapp/manager`.
    *   *Настройка*: В BotFather или через API бота настроить `Menu Button` или команду `/manager`.

### Внутренняя навигация (React)
*   **Главное Меню**: Если пользователь имеет роль Менеджера, на главной странице (или в сайдбаре) должна появляться карточка/ссылка "Портфель объектов".
*   **Кнопка "Назад"**:
    *   Из `ManagerPortfolioPage` -> Выход в главное меню приложения или закрытие WebApp.
    *   Из `ManagerObjectDetailPage` -> Возврат к `ManagerPortfolioPage`.

## 4. Связь с Backend (API)

### Эндпоинты для реализации
Необходимо подключить Mock-компоненты к реальным API:

1.  **Сводка по Портфелю**
    *   `GET /api/analytics/portfolio/summary`
    *   *Возвращает*: Список объектов с краткими фин. показателями (Бюджет, План, Факт, Статус).

2.  **Детализация Объекта**
    *   `GET /api/analytics/portfolio/{id}`
    *   *Возвращает*: Полную структуру расходов (PieChart data), Динамику (BarChart data), Список последних транзакций.

3.  **Отчетность**
    *   `GET /api/analytics/report/excel/{id}`
    *   *Возвращает*: Excel файл (blob).

## 5. Этапы внедрения

1.  **Настройка Ролей**: Проверка существующей системы ролей и выдача прав тестовому пользователю-менеджеру.
2.  **API Коннекторы**: Замена `MOCK_DATA` в React-компонентах на вызовы `axios/fetch` к вышеуказанным эндпоинтам.
3.  **Роутинг**: Настройка `react-router-dom` для корректной обработки путей `/miniapp/manager`.
4.  **Bot Update**: Обновление меню в Telegram боте.
