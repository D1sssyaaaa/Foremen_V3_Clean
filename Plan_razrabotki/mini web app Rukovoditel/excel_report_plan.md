# План реализации Excel-отчетности для Руководителя

## Цель
Разработать функционал выгрузки подробных финансовых отчетов по объектам в формате Excel (.xlsx).

## Техническое задание (Backend)

### 1. Архитектура
*   **Сервис**: `ExcelReportService` в `backend/app/analytics/services/excel_service.py`
*   **Библиотека**: `openpyxl` (стандарт для работы с Excel в Python).
*   **Метод отдачи**: StreamingResponse (io.BytesIO) — файл формируется в памяти и отдается сразу, без сохранения мусора на диск.

### 2. Структура Excel-файла (4 Листа)

#### Лист 1: Сводка (Overview)
Общая информация по объекту.
*   **Заголовок**: Название объекта, Номер договора, Период.
*   **KPI Таблица**:
    *   Бюджет (План)
    *   Фактический расход
    *   Остаток бюджета
    *   % Освоения
*   **График**: Данные для построения диаграммы (скрытая таблица, если нужно).

#### Лист 2: Материалы (Materials)
Детальный список затрат на материалы.
**Источники**: `MaterialCost` (УПД/Чеки) и `MaterialRequest`.
**Колонки**:
1.  **Дата**: Дата документа.
2.  **Документ**: Номер УПД / Чека.
3.  **Поставщик**: Контрагент.
4.  **Наименование**: Что куплено.
5.  **Ед. изм.**: шт, м, кг.
6.  **Кол-во**: Объем.
7.  **Цена**: Цена за единицу.
8.  **Сумма**: Итоговая стоимость.
9.  **Статус**: Оплачено / Ожидает.

#### Лист 3: Работы (Labor)
Зарплатная ведомость по объекту.
**Источники**: `LaborCost` (Прямые выплаты) и `TimeEntry` (Табель).
**Колонки**:
1.  **Дата**: Дата или Период (для табеля).
2.  **Исполнитель**: Бригада или ФИО сотрудника.
3.  **Вид работ**: Описание.
4.  **Объем/Часы**: Затраченное время.
5.  **Ставка**: Стоимость часа/работы.
6.  **Сумма**: Итого к выплате.

#### Лист 4: Техника и Прочее (Machinery & Other)
Все остальные расходы.
**Источники**: `EquipmentCost`, `DeliveryCost`, `OtherCost`.
**Колонки**:
1.  **Дата**: Дата использования.
2.  **Тип**: Аренда техники / Доставка / Прочее.
3.  **Наименование**: (например, "Автокран 25т").
4.  **Контрагент**: Испольнитель услуги.
5.  **Сумма**: Стоимость.

### 3. API Эндпоинт
**GET** `/api/analytics/report/excel/{object_id}`
*   **Доступ**: Только роль `MANAGER` или `ADMIN`.
*   **Response**: Файл `.xlsx` с MIME-типом `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`.
*   **Имя файла**: `Отчет_{НазваниеОбъекта}_{Дата}.xlsx`.

## Frontend Интеграция
1.  **API Метод**: Добавить функцию `downloadObjectReport(id)` в `api/manager.ts`.
2.  **UI**: Привязать эту функцию к кнопке "Скачать" (иконка Download) на странице `ManagerObjectDetailPage`.
