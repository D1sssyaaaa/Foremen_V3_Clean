# –ò–ù–ï–†–¢–ù–´–ï –ú–ê–¢–ï–†–ò–ê–õ–´ - –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

## ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

1. **Enum `MaterialType`** –≤ `app/core/models_base.py`
2. **–ü–æ–ª—è –≤ –º–æ–¥–µ–ª–∏** `MaterialRequest`: `material_type`, `delivery_time`
3. **–ú–∏–≥—Ä–∞—Ü–∏—è** –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª–µ–π
4. **–°—Ö–µ–º—ã Pydantic** —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
5. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** –ø–æ —Ç–∏–ø—É –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –≤ API

---

## –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø API

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ –Ω–∞ –ò–ù–ï–†–¢–ù–´–ï –º–∞—Ç–µ—Ä–∏–∞–ª—ã

```bash
POST /api/v1/material-requests
Content-Type: application/json

{
  "cost_object_id": 5,
  "material_type": "inert",
  "urgency": "urgent",
  "required_date": "2026-01-27",
  "delivery_time": "–¥–æ 10:00",
  "comment": "–†–∞–∑–≥—Ä—É–∑–∫–∞ –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ø–ª–æ—â–∞–¥–∫–µ, –≤—ä–µ–∑–¥ —Å–æ –¥–≤–æ—Ä–∞",
  "items": [
    {
      "material_name": "–ü–µ—Å–æ–∫ —Ä–µ—á–Ω–æ–π",
      "quantity": 20.0,
      "unit": "–º¬≥",
      "description": "2 –ú–ê–ó–∞"
    },
    {
      "material_name": "–©–µ–±–µ–Ω—å —Ñ—Ä. 20-40",
      "quantity": 15.0,
      "unit": "–º¬≥",
      "description": "1.5 –ö–ê–ú–ê–ó–∞"
    }
  ]
}
```

**–û—Ç–≤–µ—Ç**:
```json
{
  "id": 42,
  "cost_object_id": 5,
  "cost_object_name": "–ñ–ö –°–µ–≤–µ—Ä–Ω—ã–π",
  "foreman_id": 3,
  "foreman_name": "–ò–≤–∞–Ω–æ–≤ –ò.–ò.",
  "status": "–ù–û–í–ê–Ø",
  "material_type": "inert",
  "urgency": "urgent",
  "required_date": "2026-01-27",
  "delivery_time": "–¥–æ 10:00",
  "comment": "–†–∞–∑–≥—Ä—É–∑–∫–∞ –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ø–ª–æ—â–∞–¥–∫–µ, –≤—ä–µ–∑–¥ —Å–æ –¥–≤–æ—Ä–∞",
  "items": [
    {
      "id": 101,
      "material_name": "–ü–µ—Å–æ–∫ —Ä–µ—á–Ω–æ–π",
      "quantity": 20.0,
      "unit": "–º¬≥",
      "description": "2 –ú–ê–ó–∞",
      "distributed_quantity": 0.0,
      "remaining_quantity": 20.0
    },
    {
      "id": 102,
      "material_name": "–©–µ–±–µ–Ω—å —Ñ—Ä. 20-40",
      "quantity": 15.0,
      "unit": "–º¬≥",
      "description": "1.5 –ö–ê–ú–ê–ó–∞",
      "distributed_quantity": 0.0,
      "remaining_quantity": 15.0
    }
  ]
}
```

---

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ –Ω–∞ –û–ë–´–ß–ù–´–ï –º–∞—Ç–µ—Ä–∏–∞–ª—ã

```bash
POST /api/v1/material-requests
Content-Type: application/json

{
  "cost_object_id": 5,
  "material_type": "regular",
  "urgency": "normal",
  "required_date": "2026-01-30",
  "comment": "–î–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ä–∞–±–æ—Ç",
  "items": [
    {
      "material_name": "–ö–∞–±–µ–ª—å –í–í–ì 3x2.5",
      "quantity": 100,
      "unit": "–º"
    },
    {
      "material_name": "–ú—É—Ñ—Ç—ã –∫–∞–±–µ–ª—å–Ω—ã–µ",
      "quantity": 5,
      "unit": "—à—Ç"
    }
  ]
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –î–ª—è –æ–±—ã—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ø–æ–ª–µ `delivery_time` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ.

---

### 3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞—è–≤–æ–∫ –ø–æ —Ç–∏–ø—É –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

#### –¢–æ–ª—å–∫–æ –ò–ù–ï–†–¢–ù–´–ï –º–∞—Ç–µ—Ä–∏–∞–ª—ã:
```bash
GET /api/v1/material-requests?material_type=inert
```

#### –¢–æ–ª—å–∫–æ –û–ë–´–ß–ù–´–ï –º–∞—Ç–µ—Ä–∏–∞–ª—ã:
```bash
GET /api/v1/material-requests?material_type=regular
```

#### –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è:
```bash
GET /api/v1/material-requests?material_type=inert&urgency=urgent&status=–ù–û–í–ê–Ø
```

---

### 4. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω–µ—Ä—Ç–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

**–û–®–ò–ë–ö–ê** –µ—Å–ª–∏ –¥–ª—è –∏–Ω–µ—Ä—Ç–Ω—ã—Ö –ù–ï —É–∫–∞–∑–∞–Ω–æ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏:

```bash
POST /api/v1/material-requests
{
  "cost_object_id": 5,
  "material_type": "inert",
  "urgency": "urgent",
  "required_date": "2026-01-27",
  "items": [
    {"material_name": "–ü–µ—Å–æ–∫ —Ä–µ—á–Ω–æ–π", "quantity": 20.0, "unit": "–º¬≥"}
  ]
}
```

**–û—Ç–≤–µ—Ç (422 Validation Error)**:
```json
{
  "detail": [
    {
      "loc": ["body", "delivery_time"],
      "msg": "–î–ª—è –∏–Ω–µ—Ä—Ç–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å –∂–µ–ª–∞–µ–º–æ–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏",
      "type": "value_error"
    }
  ]
}
```

---

## TELEGRAM BOT - –°–¶–ï–ù–ê–†–ò–ô

```
–ë—Ä–∏–≥–∞–¥–∏—Ä ‚Üí /new_material_request

[BOT]: –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:
  üì¶ –û–ë–´–ß–ù–´–ï –ú–ê–¢–ï–†–ò–ê–õ–´ (–∫–∞–±–µ–ª—å, –∫—Ä–µ–ø–µ–∂, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç)
  üèóÔ∏è –ò–ù–ï–†–¢–ù–´–ï –ú–ê–¢–ï–†–ò–ê–õ–´ (–ø–µ—Å–æ–∫, —â–µ–±–µ–Ω—å, –ü–ì–°)

–ë—Ä–∏–≥–∞–¥–∏—Ä ‚Üí üèóÔ∏è –ò–ù–ï–†–¢–ù–´–ï –ú–ê–¢–ï–†–ò–ê–õ–´

[BOT]: –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç:
  1. –ñ–ö "–°–µ–≤–µ—Ä–Ω—ã–π"
  2. –ñ–ö "–Æ–∂–Ω—ã–π"
  
–ë—Ä–∏–≥–∞–¥–∏—Ä ‚Üí 1

[BOT]: –í–≤–µ–¥–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏):
–§–æ—Ä–º–∞—Ç: –ù–∞–∑–≤–∞–Ω–∏–µ - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º¬≥
–ü—Ä–∏–º–µ—Ä:
–ü–µ—Å–æ–∫ —Ä–µ—á–Ω–æ–π - 20
–©–µ–±–µ–Ω—å —Ñ—Ä. 20-40 - 15

–ë—Ä–∏–≥–∞–¥–∏—Ä ‚Üí 
–ü–µ—Å–æ–∫ —Ä–µ—á–Ω–æ–π - 20
–©–µ–±–µ–Ω—å —Ñ—Ä. 20-40 - 15

[BOT]: ‚è∞ –£–∫–∞–∂–∏—Ç–µ –ñ–ï–õ–ê–ï–ú–û–ï –í–†–ï–ú–Ø –¥–æ—Å—Ç–∞–≤–∫–∏:
–ü—Ä–∏–º–µ—Ä—ã: "–¥–æ 10:00", "–ø–æ—Å–ª–µ 14:00", "—Å 9:00 –¥–æ 11:00"

–ë—Ä–∏–≥–∞–¥–∏—Ä ‚Üí –¥–æ 10:00

[BOT]: –£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å —Ä–∞–∑–≥—Ä—É–∑–∫–∏:

–ë—Ä–∏–≥–∞–¥–∏—Ä ‚Üí —É–ª. –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π, 15, –≤—ä–µ–∑–¥ —Å–æ –¥–≤–æ—Ä–∞

[BOT]: –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ä–æ—á–Ω–æ—Å—Ç—å:
  üü¢ –û–ë–´–ß–ù–ê–Ø
  üü° –°–†–û–ß–ù–ê–Ø  
  üî¥ –ö–†–ò–¢–ò–ß–ù–ê–Ø

–ë—Ä–∏–≥–∞–¥–∏—Ä ‚Üí üî¥ –ö–†–ò–¢–ò–ß–ù–ê–Ø

[BOT]: ‚úÖ –ó–∞—è–≤–∫–∞ MR-2026-042 —Å–æ–∑–¥–∞–Ω–∞!

üìã –ó–ê–Ø–í–ö–ê –ù–ê –ò–ù–ï–†–¢–ù–´–ï –ú–ê–¢–ï–†–ò–ê–õ–´

‚Ññ: MR-2026-042
–û–±—ä–µ–∫—Ç: –ñ–ö "–°–µ–≤–µ—Ä–Ω—ã–π"
–ë—Ä–∏–≥–∞–¥–∏—Ä: –ò–≤–∞–Ω–æ–≤ –ò.–ò.
–°—Ä–æ—á–Ω–æ—Å—Ç—å: üî¥ –ö–†–ò–¢–ò–ß–ù–ê–Ø
‚è∞ –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏: –¥–æ 10:00
üìç –ê–¥—Ä–µ—Å: —É–ª. –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π, 15, –≤—ä–µ–∑–¥ —Å–æ –¥–≤–æ—Ä–∞

–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:
‚Ä¢ –ü–µ—Å–æ–∫ —Ä–µ—á–Ω–æ–π - 20 –º¬≥
‚Ä¢ –©–µ–±–µ–Ω—å —Ñ—Ä. 20-40 - 15 –º¬≥

–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ.
```

---

## –û–¢–õ–ò–ß–ò–Ø –ò–ù–ï–†–¢–ù–´–• –û–¢ –û–ë–´–ß–ù–´–•

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–±—ã—á–Ω—ã–µ | –ò–Ω–µ—Ä—Ç–Ω—ã–µ |
|----------|---------|----------|
| **–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏** | –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ | ‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û |
| **–ï–¥–∏–Ω–∏—Ü—ã** | —à—Ç, –º, –∫–≥, —É–ø–∞–∫ | **–º¬≥** (–∫—É–±—ã) |
| **–°—Ä–æ—á–Ω–æ—Å—Ç—å** | –æ–±—ã—á–Ω–æ "normal" | —á–∞—Å—Ç–æ "urgent"/"critical" |
| **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π** | –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ | —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (–∫–æ–ª-–≤–æ –º–∞—à–∏–Ω) |
| **–ü—Ä–∏–º–µ—Ä—ã** | –ö–∞–±–µ–ª—å, –∫—Ä–µ–ø–µ–∂, —Ç—Ä—É–±—ã | –ü–µ—Å–æ–∫, —â–µ–±–µ–Ω—å, –∫–µ—Ä–∞–º–∑–∏—Ç, –≥—Ä—É–Ω—Ç |

---

## –ë–ê–ó–ê –î–ê–ù–ù–´–•

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã `material_requests`

```sql
CREATE TABLE material_requests (
    id SERIAL PRIMARY KEY,
    cost_object_id INTEGER NOT NULL,
    foreman_id INTEGER,
    number VARCHAR(50),
    status VARCHAR(50) NOT NULL DEFAULT '–ù–û–í–ê–Ø',
    material_type VARCHAR(20) NOT NULL DEFAULT 'regular',  -- ‚úÖ –ù–û–í–û–ï
    urgency VARCHAR(20),
    required_date DATE NOT NULL,
    delivery_time VARCHAR(50),  -- ‚úÖ –ù–û–í–û–ï (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è inert)
    comment TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_material_requests_type ON material_requests(material_type);
```

---

## –ú–ò–ì–†–ê–¶–ò–Ø

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
cd backend
alembic upgrade head

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
psql -d cost_management -c "\\d material_requests"
```

---

## TODO

- [ ] **Telegram Bot FSM** - —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- [ ] **–§–∏–ª—å—Ç—Ä—ã –≤ Router** - –¥–æ–±–∞–≤–∏—Ç—å `material_type` –≤ query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- [ ] **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –æ—Ç–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –ø–æ –∏–Ω–µ—Ä—Ç–Ω—ã–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º
- [ ] **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –æ—Ç–º–µ—Ç–∫–∞ ‚è∞ –¥–ª—è —Å—Ä–æ—á–Ω—ã—Ö –∏–Ω–µ—Ä—Ç–Ω—ã—Ö

---

‚úÖ **Backend –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏–Ω–µ—Ä—Ç–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤!**
