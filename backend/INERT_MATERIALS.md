# –ò–ù–ï–†–¢–ù–´–ï –ú–ê–¢–ï–†–ò–ê–õ–´

## –ß–¢–û –≠–¢–û

**–ò–Ω–µ—Ä—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã** - —Å—ã–ø—É—á–∏–µ —Å—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã, –∑–∞–∫–∞–∑—ã–≤–∞–µ–º—ã–µ –º–∞—à–∏–Ω–∞–º–∏ (–ú–ê–ó, –ö–ê–ú–ê–ó) –∏–ª–∏ –æ–±—ä–µ–º–æ–º:
- –ü–µ—Å–æ–∫ (—Ä–µ—á–Ω–æ–π, –∫–∞—Ä—å–µ—Ä–Ω—ã–π)
- –©–µ–±–µ–Ω—å (—Ä–∞–∑–Ω—ã—Ö —Ñ—Ä–∞–∫—Ü–∏–π)
- –ü–ì–° (–ø–µ—Å—á–∞–Ω–æ-–≥—Ä–∞–≤–∏–π–Ω–∞—è —Å–º–µ—Å—å)
- –ì—Ä—É–Ω—Ç
- –ö–µ—Ä–∞–º–∑–∏—Ç

## –û–¢–õ–ò–ß–ò–Ø –û–¢ –û–ë–´–ß–ù–´–• –ú–ê–¢–ï–†–ò–ê–õ–û–í

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–±—ã—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã | –ò–Ω–µ—Ä—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã |
|----------|-------------------|-------------------|
| –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è | —à—Ç, –º, –∫–≥, —É–ø–∞–∫ | –º¬≥ (–∫—É–±—ã), –º–∞—à–∏–Ω—ã |
| –î–æ—Å—Ç–∞–≤–∫–∞ | –≤ –∑–∞—è–≤–∫–µ –∞–¥—Ä–µ—Å | –∞–¥—Ä–µ—Å + –≤—Ä–µ–º—è (–≤–∞–∂–Ω–æ!) |
| –ü–æ—Å—Ç–∞–≤—â–∏–∫ | –ª—é–±–æ–π | –æ–±—ã—á–Ω–æ –∫–∞—Ä—å–µ—Ä—ã, –∑–∞–≤–æ–¥—ã |
| –°—Ä–æ—á–Ω–æ—Å—Ç—å | –ª—é–±–∞—è | —á–∞—Å—Ç–æ —Å—Ä–æ—á–Ω–æ (–ø–æ–≥–æ–¥–∞, –≥—Ä–∞—Ñ–∏–∫) |
| –£—á–µ—Ç | –ø–æ –ø–æ–∑–∏—Ü–∏—è–º | –ø–æ –º–∞—à–∏–Ω–∞–º/–æ–±—ä–µ–º—É |

## –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ –í –°–ò–°–¢–ï–ú–ï

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ —á–µ—Ä–µ–∑ Telegram Bot

–ë—Ä–∏–≥–∞–¥–∏—Ä –≤—ã–±–∏—Ä–∞–µ—Ç:
```
üìã –ó–ê–Ø–í–ö–ê –ù–ê –ú–ê–¢–ï–†–ò–ê–õ–´
  ‚îú‚îÄ üì¶ –û–ë–´–ß–ù–´–ï –ú–ê–¢–ï–†–ò–ê–õ–´ (–∫–∞–±–µ–ª—å, –∫—Ä–µ–ø–µ–∂, etc)
  ‚îî‚îÄ üèóÔ∏è –ò–ù–ï–†–¢–ù–´–ï –ú–ê–¢–ï–†–ò–ê–õ–´ (–ø–µ—Å–æ–∫, —â–µ–±–µ–Ω—å, etc)
```

–î–ª—è –∏–Ω–µ—Ä—Ç–Ω—ã—Ö –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å:
- –¢–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞ (–ø–µ—Å–æ–∫, —â–µ–±–µ–Ω—å, –ü–ì–°, etc)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: –≤ –∫—É–±–∞—Ö (–º¬≥) –ò–õ–ò –≤ –º–∞—à–∏–Ω–∞—Ö (–ö–ê–ú–ê–ó 10—Ç, –ú–ê–ó 20—Ç)
- –û–±—ä–µ–∫—Ç –¥–æ—Å—Ç–∞–≤–∫–∏
- –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ + –ñ–ï–õ–ê–ï–ú–û–ï –í–†–ï–ú–Ø (!!!)
- –°—Ä–æ—á–Ω–æ—Å—Ç—å

### 2. –ü—Ä–∏–º–µ—Ä –∑–∞—è–≤–∫–∏

```
üÜï –ó–ê–Ø–í–ö–ê –ù–ê –ò–ù–ï–†–¢–ù–´–ï –ú–ê–¢–ï–†–ò–ê–õ–´

‚Ññ: MR-2024-042
–û–±—ä–µ–∫—Ç: –ñ–ö "–°–µ–≤–µ—Ä–Ω—ã–π"
–ë—Ä–∏–≥–∞–¥–∏—Ä: –ò–≤–∞–Ω–æ–≤ –ò.–ò.
–°—Ä–æ—á–Ω–æ—Å—Ç—å: üî• –°–†–û–ß–ù–û
–ê–¥—Ä–µ—Å: —É–ª. –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π, 15, –≤—ä–µ–∑–¥ —Å–æ –¥–≤–æ—Ä–∞
‚è∞ –í–†–ï–ú–Ø: –¥–æ 10:00 (–≤–∞–∂–Ω–æ!)

–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:
‚Ä¢ –ü–µ—Å–æ–∫ —Ä–µ—á–Ω–æ–π - 20 –º¬≥ (2 –ú–ê–ó–∞)
‚Ä¢ –©–µ–±–µ–Ω—å —Ñ—Ä. 20-40 - 15 –º¬≥ (1.5 –ö–ê–ú–ê–ó–∞)

[–°–û–ì–õ–ê–°–û–í–ê–¢–¨] [–ó–ê–ü–†–û–°–ò–¢–¨ –î–ï–¢–ê–õ–ò]
```

### 3. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞

**PROCUREMENT_MANAGER**:
- –í–∏–¥–∏—Ç —Å—Ä–æ—á–Ω–æ—Å—Ç—å –∏ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏
- –°–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞–µ—Ç –ò–õ–ò –æ—Ç–∫–ª–æ–Ω—è–µ—Ç (–∫–∞–∫ –æ–±—ã—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã)

**MATERIALS_MANAGER**:
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞—è–≤–∫—É
- –°–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å –∫–∞—Ä—å–µ—Ä–æ–º/–∑–∞–≤–æ–¥–æ–º
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –í–†–ï–ú–Ø –¥–æ—Å—Ç–∞–≤–∫–∏
- –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å "–ó–ê–ö–ê–ó–ê–ù–û"

### 4. –ü–æ—Å—Ç–∞–≤–∫–∞ –∏ –£–ü–î

–ü—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –∏–Ω–µ—Ä—Ç–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:
1. –ë—É—Ö–≥–∞–ª—Ç–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç –£–ü–î –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
2. MATERIALS_MANAGER —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –£–ü–î –ø–æ –∑–∞—è–≤–∫–∞–º
3. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫—É–±—ã –ø–æ –æ–±—ä–µ–∫—Ç–∞–º
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞—Ç—Ä–∞—Ç—ã
   - –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –∑–∞—è–≤–∫—É –≤ "–ß–ê–°–¢–ò–ß–ù–û –ü–û–°–¢–ê–í–õ–ï–ù–û" –∏–ª–∏ "–û–¢–ì–†–£–ñ–ï–ù–û"

## –ü–û–õ–Ø –ë–ê–ó–´ –î–ê–ù–ù–´–•

### –¢–∞–±–ª–∏—Ü–∞ `material_requests`

```sql
material_type VARCHAR(20) -- 'regular' / 'inert'
```

### –¢–∞–±–ª–∏—Ü–∞ `material_request_items`

–î–ª—è –∏–Ω–µ—Ä—Ç–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:
- `material_name` - –Ω–∞–∑–≤–∞–Ω–∏–µ (–ü–µ—Å–æ–∫ —Ä–µ—á–Ω–æ–π, –©–µ–±–µ–Ω—å —Ñ—Ä. 20-40)
- `quantity` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—É–±–æ–≤ (20.0, 15.5)
- `unit` - '–º¬≥' (–∫—É–±–æ–º–µ—Ç—Ä—ã)

–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `notes` –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—à–∏–Ω: "2 –ú–ê–ó–∞", "1.5 –ö–ê–ú–ê–ó–∞"

## API –≠–ù–î–ü–û–ò–ù–¢–´

–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π! –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ –∂–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

```
POST /api/v1/material-requests - —Å–æ–∑–¥–∞–Ω–∏–µ (—Å material_type='inert')
GET  /api/v1/material-requests?material_type=inert - —Ñ–∏–ª—å—Ç—Ä
```

## TELEGRAM BOT FSM

### –ù–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```python
class BotStates:
    # ...—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ...
    
    # –ó–∞—è–≤–∫–∏ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
    MR_SELECT_TYPE = "mr:select_type"  # –ù–û–í–û–ï! –æ–±—ã—á–Ω—ã–µ/–∏–Ω–µ—Ä—Ç–Ω—ã–µ
    MR_SELECT_OBJECT = "mr:select_object"
    MR_ENTER_MATERIALS = "mr:enter_materials"
    MR_ENTER_URGENCY = "mr:enter_urgency"
    MR_ENTER_ADDRESS = "mr:enter_address"
    MR_ENTER_DELIVERY_TIME = "mr:enter_delivery_time"  # –ù–û–í–û–ï! –¥–ª—è –∏–Ω–µ—Ä—Ç–Ω—ã—Ö
```

### –°—Ü–µ–Ω–∞—Ä–∏–π

```
–ë—Ä–∏–≥–∞–¥–∏—Ä ‚Üí /new_material_request
  ‚Üì
[MR_SELECT_TYPE] –í—ã–±–æ—Ä —Ç–∏–ø–∞:
  - üì¶ –û–±—ã—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
  - üèóÔ∏è –ò–Ω–µ—Ä—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
  ‚Üì
[MR_SELECT_OBJECT] –í—ã–±–æ—Ä –æ–±—ä–µ–∫—Ç–∞
  ‚Üì
[MR_ENTER_MATERIALS] –í–≤–æ–¥ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:
  –î–ª—è –∏–Ω–µ—Ä—Ç–Ω—ã—Ö: "–ü–µ—Å–æ–∫ —Ä–µ—á–Ω–æ–π - 20 –º¬≥"
  ‚Üì
[MR_ENTER_DELIVERY_TIME] –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∏–Ω–µ—Ä—Ç–Ω—ã—Ö!)
  "–¥–æ 10:00" –∏–ª–∏ "–ø–æ—Å–ª–µ 14:00"
  ‚Üì
[MR_ENTER_ADDRESS] –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
  ‚Üì
[MR_ENTER_URGENCY] –°—Ä–æ—á–Ω–æ—Å—Ç—å
  ‚Üì
‚úÖ –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!
```

## –í–ê–ñ–ù–´–ï –ú–û–ú–ï–ù–¢–´

### 1. –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ!

–ò–Ω–µ—Ä—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∑–∞–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –º–∞—à–∏–Ω–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ:
- –ù–µ –º–æ–≥—É—Ç –¥–æ–ª–≥–æ –∂–¥–∞—Ç—å
- –ü—Ä–∏–µ–∑–∂–∞—é—Ç –ø–æ –≥—Ä–∞—Ñ–∏–∫—É –∫–∞—Ä—å–µ—Ä–∞
- –ë–ª–æ–∫–∏—Ä—É—é—Ç –≤—ä–µ–∑–¥ –Ω–∞ —Å—Ç—Ä–æ–π–∫—É

**–ü–û–≠–¢–û–ú–£**: –¥–ª—è –∏–Ω–µ—Ä—Ç–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —É–∫–∞–∑—ã–≤–∞—Ç—å –∂–µ–ª–∞–µ–º–æ–µ –≤—Ä–µ–º—è!

### 2. –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è

–¢–æ–ª—å–∫–æ **–º¬≥ (–∫—É–±–æ–º–µ—Ç—Ä—ã)**. –î–∞–∂–µ –µ—Å–ª–∏ –±—Ä–∏–≥–∞–¥–∏—Ä –≥–æ–≤–æ—Ä–∏—Ç "2 –º–∞—à–∏–Ω—ã", —Å–∏—Å—Ç–µ–º–∞:
- –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ –∫—É–±—ã (–ö–ê–ú–ê–ó 10—Ç ‚âà 6-7 –º¬≥, –ú–ê–ó 20—Ç ‚âà 12-13 –º¬≥)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –±–∞–∑—É –≤ –∫—É–±–∞—Ö
- –í –ø—Ä–∏–º–µ—á–∞–Ω–∏—è—Ö –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å "2 –ú–ê–ó–∞"

### 3. –û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å

–í –æ—Ç—á–µ—Ç–∞—Ö –∏–Ω–µ—Ä—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:
- –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π "–ò–Ω–µ—Ä—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã"
- –ò–∑–º–µ—Ä—è—é—Ç—Å—è –≤ –º¬≥
- –ì—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ —Ç–∏–ø–∞–º (–ø–µ—Å–æ–∫, —â–µ–±–µ–Ω—å, –ü–ì–°)

## –ú–ò–ì–†–ê–¶–ò–Ø

```sql
-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ material_type
ALTER TABLE material_requests 
ADD COLUMN material_type VARCHAR(20) DEFAULT 'regular' NOT NULL;

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
CREATE INDEX idx_material_requests_type ON material_requests(material_type);
```

## –°–•–ï–ú–´ PYDANTIC

```python
class MaterialType(str, Enum):
    REGULAR = "regular"  # –û–±—ã—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
    INERT = "inert"      # –ò–Ω–µ—Ä—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

class MaterialRequestCreate(BaseModel):
    cost_object_id: int
    material_type: MaterialType = MaterialType.REGULAR  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–±—ã—á–Ω—ã–µ
    urgency: str  # normal, urgent, critical
    delivery_address: str
    delivery_time: Optional[str] = None  # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è –∏–Ω–µ—Ä—Ç–Ω—ã—Ö!
    notes: Optional[str] = None
    items: List[MaterialRequestItemCreate]
```

## –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ –Ω–∞ –∏–Ω–µ—Ä—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

```json
POST /api/v1/material-requests
{
  "cost_object_id": 5,
  "material_type": "inert",
  "urgency": "urgent",
  "delivery_address": "—É–ª. –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π, 15, –≤—ä–µ–∑–¥ —Å–æ –¥–≤–æ—Ä–∞",
  "delivery_time": "–¥–æ 10:00",
  "notes": "–†–∞–∑–≥—Ä—É–∑–∫–∞ –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ø–ª–æ—â–∞–¥–∫–µ",
  "items": [
    {
      "material_name": "–ü–µ—Å–æ–∫ —Ä–µ—á–Ω–æ–π",
      "quantity": 20.0,
      "unit": "–º¬≥"
    },
    {
      "material_name": "–©–µ–±–µ–Ω—å —Ñ—Ä. 20-40",
      "quantity": 15.0,
      "unit": "–º¬≥"
    }
  ]
}
```

### 2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞—è–≤–æ–∫

```
GET /api/v1/material-requests?material_type=inert
GET /api/v1/material-requests?material_type=regular
```

### 3. –û—Ç—á–µ—Ç –ø–æ –∏–Ω–µ—Ä—Ç–Ω—ã–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º

```
GET /api/v1/analytics/objects/5?material_type=inert
```

---

**–°–¢–ê–¢–£–°**: ‚úÖ –§—É–Ω–∫—Ü–∏—è –∏–Ω–µ—Ä—Ç–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**TODO**:
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –ø–æ–ª—è `material_type`
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å `MaterialType` enum
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—ã `MaterialRequestCreate`
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `delivery_time`
5. ‚è≥ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ Telegram Bot (FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è)
6. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é: –¥–ª—è inert `delivery_time` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
7. ‚è≥ –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –≤ API
8. ‚è≥ –û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
