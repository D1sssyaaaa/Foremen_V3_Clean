# –û—Ç—á—ë—Ç: –£–ª—É—á—à–µ–Ω–∏—è —Ç–∞–±–µ–ª–µ–π –†–¢–ë

**–î–∞—Ç–∞:** 26 —è–Ω–≤–∞—Ä—è 2026 –≥.  
**–ú–æ–¥—É–ª—å:** –¢–∞–±–µ–ª–∏ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ ‚Äî –æ—Ç–º–µ–Ω–∞, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—è

---

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å CANCELLED (–û—Ç–º–µ–Ω—ë–Ω)

**–î–æ–±–∞–≤–ª–µ–Ω –≤ TimeSheetStatus:**
```python
class TimeSheetStatus(str, PyEnum):
    DRAFT = "–ß–ï–†–ù–û–í–ò–ö"
    SUBMITTED = "–ù–ê –†–ê–°–°–ú–û–¢–†–ï–ù–ò–ò"
    CORRECTED = "–û–¢–ö–û–†–†–ï–ö–¢–ò–†–û–í–ê–ù–ù–´–ô"
    APPROVED = "–£–¢–í–ï–†–ñ–î–Å–ù–ù–´–ô"
    CANCELLED = "–û–¢–ú–ï–ù–Å–ù"  # ‚Üê –ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –ë—Ä–∏–≥–∞–¥–∏—Ä –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å —Ç–∞–±–µ–ª—å –¥–æ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞
- –£—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ —Ç–∞–±–µ–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç—å –Ω–µ–ª—å–∑—è

---

### 2. –°–∏—Å—Ç–µ–º–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

**–ù–æ–≤–∞—è –º–æ–¥–µ–ª—å TimeSheetComment:**
```sql
CREATE TABLE time_sheet_comments (
    id INTEGER PRIMARY KEY,
    time_sheet_id INTEGER REFERENCES time_sheets(id),
    user_id INTEGER REFERENCES users(id),
    comment_type VARCHAR(50),  -- GENERAL, HR_CORRECTION, CANCELLATION
    text TEXT NOT NULL,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

**–¢–∏–ø—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (CommentType):**
- **GENERAL** ‚Äî –æ–±—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- **HR_CORRECTION** ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π HR –ø—Ä–∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–µ
- **CANCELLATION** ‚Äî –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç–º–µ–Ω—ã

**–°–≤—è–∑–∏:**
- `TimeSheet.comments` ‚Üí —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Ç–∞–±–µ–ª—è
- `TimeSheetComment.user` ‚Üí –∞–≤—Ç–æ—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è

---

### 3. –ü–æ–ª–µ –¥–ª—è –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–º–µ–Ω—ã

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ TimeSheet:**
```python
cancellation_reason = Column(Text, nullable=True)  # –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–º–µ–Ω—ã
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ —Ç–∞–±–µ–ª—è
- –í–∏–¥–Ω–æ –±—Ä–∏–≥–∞–¥–∏—Ä—É –∏ HR-–º–µ–Ω–µ–¥–∂–µ—Ä—É
- –î—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Ç–∏–ø–∞ CANCELLATION

---

## üöÄ –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã TimeSheetService

### cancel_timesheet()
–û—Ç–º–µ–Ω–∞ —Ç–∞–±–µ–ª—è –±—Ä–∏–≥–∞–¥–∏—Ä–æ–º

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `timesheet_id` ‚Äî ID —Ç–∞–±–µ–ª—è
- `user_id` ‚Äî ID –±—Ä–∏–≥–∞–¥–∏—Ä–∞
- `cancellation_reason` ‚Äî –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç–º–µ–Ω—ã

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ (—Ç–æ–ª—å–∫–æ –±—Ä–∏–≥–∞–¥–∏—Ä —Å–≤–æ–µ–≥–æ —Ç–∞–±–µ–ª—è)
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ (–Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å —É—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π)
3. –°–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ CANCELLED
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –≤ `cancellation_reason`
5. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è —Ç–∏–ø–∞ CANCELLATION
6. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ HR-–º–µ–Ω–µ–¥–∂–µ—Ä–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π TabSheet

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
- `ValueError` ‚Äî –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π —Å—Ç–∞—Ç—É—Å

---

### add_comment()
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ —Ç–∞–±–µ–ª—é (–æ—Ç HR)

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `timesheet_id` ‚Äî ID —Ç–∞–±–µ–ª—è
- `user_id` ‚Äî ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (HR-–º–µ–Ω–µ–¥–∂–µ—Ä)
- `comment_text` ‚Äî —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
- `comment_type` ‚Äî —Ç–∏–ø (GENERAL, HR_CORRECTION, CANCELLATION)

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–∞–±–µ–ª—è
2. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ TimeSheetComment
3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±—Ä–∏–≥–∞–¥–∏—Ä–∞ –æ –Ω–æ–≤–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** —Å–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è

---

### get_comments()
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `timesheet_id` ‚Äî ID —Ç–∞–±–µ–ª—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞:**
```json
[
  {
    "id": 1,
    "timesheet_id": 5,
    "user_id": 3,
    "comment_type": "HR_CORRECTION",
    "text": "–ò—Å–ø—Ä–∞–≤—å—Ç–µ —á–∞—Å—ã –∑–∞ 15 —è–Ω–≤–∞—Ä—è",
    "created_at": "2026-01-26T10:30:00"
  }
]
```

---

### validate_overtime()
–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–æ–∫ (>12 —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å)

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `timesheet_id` ‚Äî ID —Ç–∞–±–µ–ª—è

**–õ–æ–≥–∏–∫–∞:**
1. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —á–∞—Å–æ–≤ –ø–æ –¥–Ω—è–º –∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞–º
2. –ü–æ–∏—Å–∫ —Å–ª—É—á–∞–µ–≤ > 12 —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å
3. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞—Ö

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```json
{
  "has_overtime": true,
  "overtime_count": 2,
  "cases": [
    {
      "member_id": 10,
      "member_name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
      "date": "2026-01-15",
      "hours": 14,
      "overtime_hours": 2
    }
  ],
  "warning": "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª–µ–µ 12 —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å!"
}
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ HR-–º–µ–Ω–µ–¥–∂–µ—Ä–∞
- –ö–æ–Ω—Ç—Ä–æ–ª—å —Ç—Ä—É–¥–æ–≤–æ–≥–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞

---

## üì° –ù–æ–≤—ã–µ API endpoints

### POST /api/v1/time-sheets/{timesheet_id}/cancel
–û—Ç–º–µ–Ω–∞ —Ç–∞–±–µ–ª—è –±—Ä–∏–≥–∞–¥–∏—Ä–æ–º

**–î–æ—Å—Ç—É–ø:** FOREMAN (—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Ç–∞–±–µ–ª–∏)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `cancellation_reason` (query) ‚Äî –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç–º–µ–Ω—ã

**–ó–∞–ø—Ä–æ—Å:**
```bash
POST /api/v1/time-sheets/5/cancel?cancellation_reason=–û—à–∏–±–∫–∞ –≤ –¥–∞—Ç–∞—Ö
Authorization: Bearer <token>
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 5,
  "status": "–û–¢–ú–ï–ù–Å–ù",
  "cancellation_reason": "–û—à–∏–±–∫–∞ –≤ –¥–∞—Ç–∞—Ö",
  "message": "–¢–∞–±–µ–ª—å #5 –æ—Ç–º–µ–Ω—ë–Ω"
}
```

**–û—à–∏–±–∫–∏:**
- `400` ‚Äî –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å (—É—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–π –∏–ª–∏ —á—É–∂–æ–π)
- `404` ‚Äî —Ç–∞–±–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ `audit_log`
- ‚úÖ –£–≤–µ–¥–æ–º–ª—è–µ—Ç—Å—è HR-–º–µ–Ω–µ–¥–∂–µ—Ä

---

### POST /api/v1/time-sheets/{timesheet_id}/comments
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ —Ç–∞–±–µ–ª—é

**–î–æ—Å—Ç—É–ø:** HR_MANAGER, MANAGER

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `comment_text` (query) ‚Äî —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
- `comment_type` (query, optional) ‚Äî —Ç–∏–ø (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é GENERAL)

**–ó–∞–ø—Ä–æ—Å:**
```bash
POST /api/v1/time-sheets/5/comments?comment_text=–ò—Å–ø—Ä–∞–≤—å—Ç–µ —á–∞—Å—ã&comment_type=HR_CORRECTION
Authorization: Bearer <token>
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 12,
  "timesheet_id": 5,
  "user_id": 3,
  "comment_type": "HR_CORRECTION",
  "text": "–ò—Å–ø—Ä–∞–≤—å—Ç–µ —á–∞—Å—ã –∑–∞ 15 —è–Ω–≤–∞—Ä—è",
  "created_at": "2026-01-26T10:30:00"
}
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤ `audit_log`
- ‚úÖ –£–≤–µ–¥–æ–º–ª—è–µ—Ç—Å—è –±—Ä–∏–≥–∞–¥–∏—Ä —á–µ—Ä–µ–∑ Telegram

---

### GET /api/v1/time-sheets/{timesheet_id}/comments
–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Ç–∞–±–µ–ª—è

**–î–æ—Å—Ç—É–ø:** –≤—Å–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

**–ó–∞–ø—Ä–æ—Å:**
```bash
GET /api/v1/time-sheets/5/comments
Authorization: Bearer <token>
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "timesheet_id": 5,
  "comments": [
    {
      "id": 10,
      "timesheet_id": 5,
      "user_id": 3,
      "comment_type": "HR_CORRECTION",
      "text": "–ò—Å–ø—Ä–∞–≤—å—Ç–µ —á–∞—Å—ã –∑–∞ 15 —è–Ω–≤–∞—Ä—è",
      "created_at": "2026-01-26T10:30:00"
    },
    {
      "id": 11,
      "timesheet_id": 5,
      "user_id": 1,
      "comment_type": "GENERAL",
      "text": "–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ",
      "created_at": "2026-01-26T11:00:00"
    }
  ],
  "total": 2
}
```

---

### GET /api/v1/time-sheets/{timesheet_id}/overtime-check
–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–æ–∫

**–î–æ—Å—Ç—É–ø:** HR_MANAGER, MANAGER, FOREMAN

**–ó–∞–ø—Ä–æ—Å:**
```bash
GET /api/v1/time-sheets/5/overtime-check
Authorization: Bearer <token>
```

**–û—Ç–≤–µ—Ç (–Ω–µ—Ç –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–æ–∫):**
```json
{
  "has_overtime": false,
  "overtime_count": 0,
  "cases": [],
  "warning": null
}
```

**–û—Ç–≤–µ—Ç (–µ—Å—Ç—å –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏):**
```json
{
  "has_overtime": true,
  "overtime_count": 1,
  "cases": [
    {
      "member_id": 10,
      "member_name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
      "date": "2026-01-15",
      "hours": 14.0,
      "overtime_hours": 2.0
    }
  ],
  "warning": "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª–µ–µ 12 —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å!"
}
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ `submit_timesheet()`
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ UI
- –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ HR –ø—Ä–∏ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞—Ö

---

## üîÑ –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ç–∞–±–µ–ª—è

### –î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```
–ß–ï–†–ù–û–í–ò–ö ‚Üí –ù–ê –†–ê–°–°–ú–û–¢–†–ï–ù–ò–ò ‚Üí –û–¢–ö–û–†–†–ï–ö–¢–ò–†–û–í–ê–ù–ù–´–ô ‚Üí –£–¢–í–ï–†–ñ–î–Å–ù–ù–´–ô
```

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```
–ß–ï–†–ù–û–í–ò–ö 
  ‚Üì (submit)
–ù–ê –†–ê–°–°–ú–û–¢–†–ï–ù–ò–ò 
  ‚Üì (approve)                 ‚Üì (reject)
–£–¢–í–ï–†–ñ–î–Å–ù–ù–´–ô             –û–¢–ö–û–†–†–ï–ö–¢–ò–†–û–í–ê–ù–ù–´–ô
                              ‚Üì (submit)
                         –ù–ê –†–ê–°–°–ú–û–¢–†–ï–ù–ò–ò
                              ‚Üì
                         –£–¢–í–ï–†–ñ–î–Å–ù–ù–´–ô

–û–¢–ú–ï–ù–ê (–ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –¥–æ –£–¢–í–ï–†–ñ–î–Å–ù–ù–´–ô):
  ‚Üì (cancel)
–û–¢–ú–ï–ù–Å–ù
```

**–ü—Ä–∞–≤–∏–ª–∞:**
- **–ß–ï–†–ù–û–í–ò–ö** ‚Üí –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –±—Ä–∏–≥–∞–¥–∏—Ä
- **–ù–ê –†–ê–°–°–ú–û–¢–†–ï–ù–ò–ò** ‚Üí –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –±—Ä–∏–≥–∞–¥–∏—Ä
- **–û–¢–ö–û–†–†–ï–ö–¢–ò–†–û–í–ê–ù–ù–´–ô** ‚Üí –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –±—Ä–∏–≥–∞–¥–∏—Ä
- **–£–¢–í–ï–†–ñ–î–Å–ù–ù–´–ô** ‚Üí –æ—Ç–º–µ–Ω–∏—Ç—å –ù–ï–õ–¨–ó–Ø
- **–û–¢–ú–ï–ù–Å–ù** ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å

---

## üìä –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü:** 19 (–±—ã–ª–æ 18)

**–ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞:**
- `time_sheet_comments` ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Ç–∞–±–µ–ª—è–º

**–ò–∑–º–µ–Ω—ë–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞:**
- `time_sheets` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `cancellation_reason`

**–ò–Ω–¥–µ–∫—Å—ã:**
- `time_sheet_comments.time_sheet_id` ‚Äî –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- `time_sheets.status` ‚Äî –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É

---

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û—Ç–º–µ–Ω–∞ —Ç–∞–±–µ–ª—è –±—Ä–∏–≥–∞–¥–∏—Ä–æ–º

```bash
# 1. –ë—Ä–∏–≥–∞–¥–∏—Ä —Å–æ–∑–¥–∞–ª —Ç–∞–±–µ–ª—å
POST /api/v1/time-sheets/
‚Üí –°—Ç–∞—Ç—É—Å: –ß–ï–†–ù–û–í–ò–ö

# 2. –ë—Ä–∏–≥–∞–¥–∏—Ä –æ–±–Ω–∞—Ä—É–∂–∏–ª –æ—à–∏–±–∫—É –∏ –æ—Ç–º–µ–Ω—è–µ—Ç
POST /api/v1/time-sheets/5/cancel?cancellation_reason=–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞—Ç—ã
‚Üí –°—Ç–∞—Ç—É—Å: –û–¢–ú–ï–ù–Å–ù
‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ HR-–º–µ–Ω–µ–¥–∂–µ—Ä–∞
‚Üí –ó–∞–ø–∏—Å—å –≤ audit_log

# 3. –ë—Ä–∏–≥–∞–¥–∏—Ä —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π —Ç–∞–±–µ–ª—å —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
POST /api/v1/time-sheets/
‚Üí –ù–æ–≤—ã–π —Ç–∞–±–µ–ª—å #6
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: HR-–º–µ–Ω–µ–¥–∂–µ—Ä –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

```bash
# 1. –ë—Ä–∏–≥–∞–¥–∏—Ä –æ—Ç–ø—Ä–∞–≤–∏–ª —Ç–∞–±–µ–ª—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
POST /api/v1/time-sheets/7/submit
‚Üí –°—Ç–∞—Ç—É—Å: –ù–ê –†–ê–°–°–ú–û–¢–†–ï–ù–ò–ò

# 2. HR –æ–±–Ω–∞—Ä—É–∂–∏–ª –æ—à–∏–±–∫–∏ –∏ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
POST /api/v1/time-sheets/7/comments?comment_text=–ò—Å–ø—Ä–∞–≤—å—Ç–µ —á–∞—Å—ã 15.01&comment_type=HR_CORRECTION
‚Üí –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å–æ–∑–¥–∞–Ω
‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –±—Ä–∏–≥–∞–¥–∏—Ä–∞

# 3. HR –æ—Ç–∫–ª–æ–Ω—è–µ—Ç —Ç–∞–±–µ–ª—å
POST /api/v1/time-sheets/7/reject
‚Üí –°—Ç–∞—Ç—É—Å: –û–¢–ö–û–†–†–ï–ö–¢–ò–†–û–í–ê–ù–ù–´–ô

# 4. –ë—Ä–∏–≥–∞–¥–∏—Ä —á–∏—Ç–∞–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
GET /api/v1/time-sheets/7/comments
‚Üí –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

# 5. –ë—Ä–∏–≥–∞–¥–∏—Ä –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–Ω–æ–≤–∞
POST /api/v1/time-sheets/7/submit
‚Üí –°—Ç–∞—Ç—É—Å: –ù–ê –†–ê–°–°–ú–û–¢–†–ï–ù–ò–ò
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–æ–∫

```bash
# 1. –ë—Ä–∏–≥–∞–¥–∏—Ä –≥–æ—Ç–æ–≤–∏—Ç —Ç–∞–±–µ–ª—å –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ
GET /api/v1/time-sheets/8/overtime-check
‚Üí –û—Ç–≤–µ—Ç: "has_overtime": true

# 2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞—Ö
{
  "warning": "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª–µ–µ 12 —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å!",
  "cases": [...]
}

# 3. –ë—Ä–∏–≥–∞–¥–∏—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∏–ª–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç
# –ï—Å–ª–∏ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∞–ª—å–Ω—ã–µ ‚Üí submit —Å —Ñ–ª–∞–≥–æ–º confirmed=true
# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Üí –∏—Å–ø—Ä–∞–≤–∏—Ç—å —á–∞—Å—ã
```

---

## üîí –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

| –î–µ–π—Å—Ç–≤–∏–µ | FOREMAN | HR_MANAGER | MANAGER | ADMIN |
|----------|---------|------------|---------|-------|
| –û—Ç–º–µ–Ω–∏—Ç—å —Ç–∞–±–µ–ª—å | ‚úÖ –°–≤–æ–π | ‚ùå | ‚ùå | ‚ùå |
| –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–æ–∫ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |

---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Audit Log
–í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

**–û—Ç–º–µ–Ω–∞ —Ç–∞–±–µ–ª—è:**
```json
{
  "action": "CANCEL_TIMESHEET",
  "entity_type": "TimeSheet",
  "entity_id": 5,
  "new_value": "–û–¢–ú–ï–ù–Å–ù",
  "description": "–û—Ç–º–µ–Ω–∞ —Ç–∞–±–µ–ª—è #5. –ü—Ä–∏—á–∏–Ω–∞: –û—à–∏–±–∫–∞ –≤ –¥–∞—Ç–∞—Ö"
}
```

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:**
```json
{
  "action": "ADD_COMMENT",
  "entity_type": "TimeSheet",
  "entity_id": 5,
  "description": "–î–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ç–∞–±–µ–ª—é #5"
}
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ü—Ä–∏ –æ—Ç–º–µ–Ω–µ —Ç–∞–±–µ–ª—è:**
- HR_MANAGER –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
- –°–æ–æ–±—â–µ–Ω–∏–µ: "–¢–∞–±–µ–ª—å #5 –æ—Ç–º–µ–Ω—ë–Ω –±—Ä–∏–≥–∞–¥–∏—Ä–æ–º"

**–ü—Ä–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:**
- –ë—Ä–∏–≥–∞–¥–∏—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- –°–æ–æ–±—â–µ–Ω–∏–µ: "HR-–º–µ–Ω–µ–¥–∂–µ—Ä –æ—Å—Ç–∞–≤–∏–ª –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ç–∞–±–µ–ª—é #5"

---

## ‚ú® –ò—Ç–æ–≥–∏

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –°—Ç–∞—Ç—É—Å –û–¢–ú–ï–ù–Å–ù –¥–ª—è —Ç–∞–±–µ–ª–µ–π
- ‚úÖ –ú–æ–¥–µ–ª—å TimeSheetComment –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
- ‚úÖ 4 –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–∞ –≤ TimeSheetService
- ‚úÖ 4 –Ω–æ–≤—ã—Ö API endpoint
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–æ–∫ >12 —á–∞—Å–æ–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å audit_log
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ time_sheet_comments –≤ –ë–î

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `app/core/models_base.py` ‚Äî TimeSheetStatus + CommentType
- `app/models.py` ‚Äî TimeSheetComment –º–æ–¥–µ–ª—å
- `app/time_sheets/service.py` ‚Äî 4 –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–∞
- `app/time_sheets/router.py` ‚Äî 4 –Ω–æ–≤—ã—Ö endpoint
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äî 19 —Ç–∞–±–ª–∏—Ü

**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~300 –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫

---

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **Excel –∑–∞–≥—Ä—É–∑–∫–∞ —Å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º** üìä
   - –ü–∞—Ä—Å–∏–Ω–≥ Excel —Ñ–∞–π–ª–æ–≤
   - Preview –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏ –æ–±—ä–µ–∫—Ç–æ–≤

2. **WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** üîî
   - –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–∞
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –±—é–¥–∂–µ—Ç–∞—Ö, —Å—Ç–∞—Ç—É—Å–∞—Ö

3. **–£–ü–î —É–ª—É—á—à–µ–Ω–∏—è** üìÑ
   - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
   - –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
   - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω:** ‚úÖ http://127.0.0.1:8000  
**Swagger UI:** http://127.0.0.1:8000/docs  
**–ë–î:** 19 —Ç–∞–±–ª–∏—Ü, –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ
