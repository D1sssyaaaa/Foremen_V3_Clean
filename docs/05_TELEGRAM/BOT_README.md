# ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫ Telegram –ë–æ—Ç–∞

## üìå –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
‚úÖ –ë–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ  
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å–∏—Å—Ç–µ–º—ã  
‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å backend API  
‚úÖ –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞  

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (5 –º–∏–Ω—É—Ç)

### 1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram
```
1. –ù–∞–π–¥–∏—Ç–µ @BotFather –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ: /newbot
3. –í–≤–µ–¥–∏—Ç–µ –∏–º—è: Construction Costs Bot
4. –í–≤–µ–¥–∏—Ç–µ username: your_construction_bot
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω
```

### 2. –£–∑–Ω–∞–π—Ç–µ —Å–≤–æ–π Telegram ID
```
1. –ù–∞–π–¥–∏—Ç–µ @userinfobot –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ: /start
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à ID
```

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env
–û—Ç–∫—Ä–æ–π—Ç–µ `backend/.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ:
```env
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–æ—Ç_BotFather
TELEGRAM_ADMIN_IDS=–≤–∞—à_telegram_id
```

### 4. –ü—Ä–∏–≤—è–∂–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```powershell
# –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫:
link-telegram.bat
```

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
```powershell
# –í–∞—Ä–∏–∞–Ω—Ç 1: –¢–æ–ª—å–∫–æ –±–æ—Ç
start-bot.bat

# –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (Backend + Frontend + Bot)
start-all-with-bot.bat
```

### 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Telegram
```
1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ: /start
3. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –º–µ–Ω—é
```

---

## üìñ –§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞

### –î–ª—è –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤ (FOREMAN):
- üì¶ **–ó–∞—è–≤–∫–∏ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã**
  - –û–±—ã—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–∫–∏—Ä–ø–∏—á, —Ü–µ–º–µ–Ω—Ç, –≥–≤–æ–∑–¥–∏)
  - –ò–Ω–µ—Ä—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–ø–µ—Å–æ–∫, —â–µ–±–µ–Ω—å, —Ä–∞—Å—Ç–≤–æ—Ä) —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- üöú **–ó–∞—è–≤–∫–∏ –Ω–∞ —Ç–µ—Ö–Ω–∏–∫—É** - –∞—Ä–µ–Ω–¥–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∏ —Ç–µ—Ö–Ω–∏–∫–∏
- üìä **–¢–∞–±–µ–ª–∏ –†–¢–ë** - –ø–æ–¥–∞—á–∞ —á–µ—Ä–µ–∑ Excel —Ñ–∞–π–ª
- üìà **–ú–æ–∏ –∑–∞—è–≤–∫–∏** - –ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–æ–≤

### –î–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤:
- üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞—è–≤–∫–∞—Ö –≤ –∏—Ö –∑–æ–Ω–µ
- üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫

### –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- ‚ÑπÔ∏è –ü–æ–º–æ—â—å –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- üîÑ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã
- ‚ùå –û—Ç–º–µ–Ω–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–æ—Ç–∞

```
backend/app/bot/
‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ handlers/            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ common.py       # /start, /help
‚îÇ   ‚îú‚îÄ‚îÄ materials.py    # –ó–∞—è–≤–∫–∏ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ equipment.py    # –ó–∞—è–≤–∫–∏ –Ω–∞ —Ç–µ—Ö–Ω–∏–∫—É
‚îÇ   ‚îî‚îÄ‚îÄ time_sheets.py  # –¢–∞–±–µ–ª–∏ –†–¢–ë
‚îú‚îÄ‚îÄ keyboards/          # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ states/             # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îî‚îÄ‚îÄ utils/              # –£—Ç–∏–ª–∏—Ç—ã (API –∫–ª–∏–µ–Ω—Ç)
```

---

## üîß –°–∫—Ä–∏–ø—Ç—ã

### Windows (.bat)
- `start-bot.bat` - –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
- `link-telegram.bat` - –ü—Ä–∏–≤—è–∑–∫–∞ Telegram ID
- `start-all-with-bot.bat` - –ó–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### PowerShell (.ps1)
- `start-bot.ps1` - –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏

---

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –ü—Ä–∏–≤—è–∑–∫–∞ Telegram ID
```powershell
link-telegram.bat
```
–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é:
1. –ü—Ä–∏–≤—è–∑–∞—Ç—å ID –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
2. –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. –û—Ç–≤—è–∑–∞—Ç—å ID
4. –í—ã—Ö–æ–¥

### –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ë–î
```sql
UPDATE users 
SET telegram_chat_id = 123456789 
WHERE username = 'admin';
```

---

## üì° API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### Endpoint –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram
```http
POST /api/v1/auth/telegram/login
Content-Type: application/json

{
  "telegram_user_id": 123456789
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "access_token": "eyJ...",
  "refresh_token": "eyJ...",
  "token_type": "bearer"
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –±–æ—Ç–µ
```python
api = APIClient()
token = await api.login_telegram(telegram_user_id)
api.token = token
# –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ó–∞—è–≤–∫–∞ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–æ–±—ã—á–Ω—ã–µ)
```
–ë–æ—Ç: –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: üèóÔ∏è –û–±—ã—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
–ë–æ—Ç: –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –¥–æ–º–∞ ‚Ññ1
–ë–æ—Ç: –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ö–∏—Ä–ø–∏—á –∫—Ä–∞—Å–Ω—ã–π
... –∏ —Ç.–¥.
```

### 2. –ó–∞—è–≤–∫–∞ –Ω–∞ –∏–Ω–µ—Ä—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
```
–ë–æ—Ç: –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ü™® –ò–Ω–µ—Ä—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
–ë–æ—Ç: –í–≤–µ–¥–∏—Ç–µ –∂–µ–ª–∞–µ–º–æ–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: 08:00-12:00
–ë–æ—Ç: –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç
... –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ
```

### 3. –¢–∞–±–µ–ª—å –†–¢–ë
```
–ë–æ—Ç: –û—Ç–ø—Ä–∞–≤—å—Ç–µ Excel —Ñ–∞–π–ª —Å —Ç–∞–±–µ–ª–µ–º
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª timesheet.xlsx]
–ë–æ—Ç: –í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –¢–∞–±–µ–ª—å –∑–∞ –Ω–µ–¥–µ–ª—é 20-26 —è–Ω–≤–∞—Ä—è
–ë–æ—Ç: [–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–≤—å—é] –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å?
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ‚úÖ –î–∞
–ë–æ—Ç: –¢–∞–±–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!
```

---

## üêõ Troubleshooting

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```powershell
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω
cat backend\.env | Select-String TELEGRAM_BOT_TOKEN

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
cd backend
pip install -r requirements.txt
```

### "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"
```powershell
# –ü—Ä–∏–≤—è–∂–∏—Ç–µ Telegram ID
link-telegram.bat

# –ò–ª–∏ —á–µ—Ä–µ–∑ SQL
sqlite3 backend/construction_costs.db
UPDATE users SET telegram_chat_id = –í–ê–®_ID WHERE username = 'admin';
```

### Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```powershell
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ backend
start-backend.bat

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
curl http://localhost:8000/docs
```

### –§–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç (.xlsx –¥–ª—è —Ç–∞–±–µ–ª–µ–π)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä (–¥–æ 20MB)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É Excel

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:
- [TELEGRAM_QUICKSTART.md](TELEGRAM_QUICKSTART.md) - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- [TELEGRAM_BOT_SETUP.md](TELEGRAM_BOT_SETUP.md) - –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- [README-–ó–ê–ü–£–°–ö.txt](README-–ó–ê–ü–£–°–ö.txt) - –û–±—â–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞

### API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- Backend API: http://localhost:8000/docs
- aiogram docs: https://docs.aiogram.dev/

---

## ‚úÖ Checklist –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] –°–æ–∑–¥–∞–Ω –±–æ—Ç –≤ @BotFather
- [ ] –ü–æ–ª—É—á–µ–Ω —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
- [ ] –£–∑–Ω–∞–Ω Telegram ID
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω `.env` —Ñ–∞–π–ª
- [ ] –ü—Ä–∏–≤—è–∑–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫ Telegram
- [ ] –ó–∞–ø—É—â–µ–Ω backend
- [ ] –ó–∞–ø—É—â–µ–Ω –±–æ—Ç
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ /start
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ —Ç–µ—Ö–Ω–∏–∫—É
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω —Ç–∞–±–µ–ª—å –†–¢–ë

---

## üöÄ Production —Ä–µ–∂–∏–º

### Webhook –≤–º–µ—Å—Ç–æ polling
1. –ü–æ–ª—É—á–∏—Ç–µ –¥–æ–º–µ–Ω —Å SSL
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ nginx
3. –û–±–Ω–æ–≤–∏—Ç–µ `.env`:
```env
TELEGRAM_WEBHOOK_URL=https://your-domain.com/bot/webhook
```

### Systemd service (Linux)
```ini
[Unit]
Description=Construction Costs Telegram Bot
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/path/to/backend
ExecStart=/path/to/.venv/bin/python -m app.bot.main
Restart=always

[Install]
WantedBy=multi-user.target
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–ê–ñ–ù–û:**
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
- `.env` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ `.gitignore`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è dev/prod
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ admin –∫–æ–º–∞–Ω–¥–∞–º

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–æ–±–ª–µ–º—ã? –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏ –±–æ—Ç–∞ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
2. Backend –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:8000
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ Telegram
4. –¢–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤ .env

---

–ì–æ—Ç–æ–≤–æ! –ë–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ
