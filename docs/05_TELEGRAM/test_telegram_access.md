# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Telegram –∫–æ–º–∞–Ω–¥—ã /request-access

## –û–ø–∏—Å–∞–Ω–∏–µ
–ö–æ–º–∞–Ω–¥–∞ `/request-access` –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—Ä–∏–≥–∞–¥–∏—Ä–∞–º –∑–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç—É —É—á–µ—Ç–∞ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.

## –ö–æ–º–∞–Ω–¥—ã –≤ –±–æ—Ç–µ

### `/request-access` (–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ "üèóÔ∏è –ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø")
–ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—Ä–æ—Å–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—ä–µ–∫—Ç—É.

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤
2. –ë—Ä–∏–≥–∞–¥–∏—Ä –≤—ã–±–∏—Ä–∞–µ—Ç –Ω—É–∂–Ω—ã–π –æ–±—ä–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏–µ–º –Ω–∞ –∫–Ω–æ–ø–∫—É
3. –ë–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —É–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. –ë—Ä–∏–≥–∞–¥–∏—Ä –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –∏–ª–∏ –≤–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç
5. –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `PENDING`
6. –ë–æ—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ

### `/my-requests`
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–æ—Å—Ç—É–ø–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∏—Ö —Å—Ç–∞—Ç—É—Å–∞–º–∏.

**–°—Ç–∞—Ç—É—Å—ã:**
- ‚è≥ `PENDING` - –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏ (–æ–∂–∏–¥–∞–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞)
- ‚úÖ `APPROVED` - –û–¥–æ–±—Ä–µ–Ω–æ (–¥–æ—Å—Ç—É–ø –≤—ã–¥–∞–Ω)
- ‚ùå `REJECTED` - –û—Ç–∫–ª–æ–Ω–µ–Ω–æ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è)

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- `backend/app/bot/handlers/objects.py` - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥ –∑–∞–ø—Ä–æ—Å–∞ –¥–æ—Å—Ç—É–ø–∞ (208 —Å—Ç—Ä–æ–∫)

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
1. **`backend/app/bot/handlers/common.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "üèóÔ∏è –ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø"

2. **`backend/app/bot/utils/api_client.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã:
     - `get_objects(token)` - –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤
     - `request_object_access(object_id, reason, token)` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å
     - `get_my_access_requests(token)` - –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–≤–æ–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

3. **`backend/app/bot/keyboards/__init__.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üèóÔ∏è –ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø" –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

4. **`backend/app/bot/main.py`**
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä `objects`

5. **`backend/app/bot/handlers/__init__.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `objects`

## FSM –°–æ—Å—Ç–æ—è–Ω–∏—è

```python
class ObjectAccessStates(StatesGroup):
    waiting_for_object = State()      # –û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –æ–±—ä–µ–∫—Ç–∞
    waiting_for_reason = State()       # –û–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –ø—Ä–∏—á–∏–Ω—ã
```

## API –ú–µ—Ç–æ–¥—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–∑ Backend

### GET `/api/v1/objects/`
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer {token}`

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "id": 1,
    "name": "–î–æ–º –Ω–∞ —É–ª. –ü–µ—Ä–≤–æ–º–∞–π–Ω–æ–π",
    "code": "OBJ-001",
    "contract_number": "–ö–î-2025-001",
    "contract_amount": 5000000,
    "status": "ACTIVE"
  }
]
```

### POST `/api/v1/objects/{id}/request-access`
–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç—É.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `id` (path) - ID –æ–±—ä–µ–∫—Ç–∞
- —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer {token}`

**Body:**
```json
{
  "reason": "–ù—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –Ω–∞ –æ–±—ä–µ–∫—Ç–µ"
}
```

**–û—Ç–≤–µ—Ç:** 200 OK

### GET `/api/v1/objects/access-requests/my`
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–æ—Å—Ç—É–ø–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "id": 1,
    "object_id": 1,
    "object_name": "–î–æ–º –Ω–∞ —É–ª. –ü–µ—Ä–≤–æ–º–∞–π–Ω–æ–π",
    "object_code": "OBJ-001",
    "status": "PENDING",
    "reason": "–ù—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤",
    "created_at": "2025-01-27T10:30:00Z",
    "rejection_reason": null
  }
]
```

## –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞
1. ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º `/request-access`
2. ‚úÖ –í—ã–±–∏—Ä–∞–µ–º –æ–±—ä–µ–∫—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
3. ‚úÖ –£–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏—á–∏–Ω—É –∏–ª–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
4. ‚úÖ –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ `/my-requests`

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ç–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç
1. ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–π `/request-access` –Ω–∞ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç
2. ‚úÖ Backend –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É "—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
3. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥—Ä—É–∂–µ—Å—Ç–≤–µ–Ω–Ω—É—é –æ—à–∏–±–∫—É

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—Ç–º–µ–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞
1. ‚úÖ –ù–∞ —ç—Ç–∞–ø–µ –≤—ã–±–æ—Ä–∞ –æ–±—ä–µ–∫—Ç–∞ –Ω–∞–∂–∏–º–∞–µ–º "‚ùå –û—Ç–º–µ–Ω–∞"
2. ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
3. ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—á–∏—â–∞–µ—Ç—Å—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø—Ä–æ—Å–æ–≤
1. ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º `/my-requests`
2. ‚úÖ –í–∏–¥–∏–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
3. ‚úÖ –í–∏–¥–∏–º —Å—Ç–∞—Ç—É—Å—ã (PENDING, APPROVED, REJECTED)

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Web UI (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

–í –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:
- `ObjectAccessRequest.tsx` - —Ñ–æ—Ä–º–∞ –∑–∞–ø—Ä–æ—Å–∞ –¥–æ—Å—Ç—É–ø–∞ (–¥–ª—è –±—Ä–∏–≥–∞–¥–∏—Ä–æ–≤)
- `AdminAccessRequests.tsx` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤)

## –ß—Ç–æ –¥–∞–ª—å—à–µ

### –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –°–æ–∑–¥–∞—Ç—å React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –¥–æ—Å—Ç—É–ø–∞
- [ ] –°–æ–∑–¥–∞—Ç—å UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–∞–¥–º–∏–Ω)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ web UI

### Backend —É–ª—É—á—à–µ–Ω–∏—è
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º –æ –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- [ ] WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞–ø—Ä–æ—Å–æ–≤

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

```
# –ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø
/request-access

# –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–æ–∏ –∑–∞–ø—Ä–æ—Å—ã
/my-requests

# –ö–Ω–æ–ø–∫–∞ –∏–∑ –º–µ–Ω—é
"üèóÔ∏è –ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø"
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

| –û—à–∏–±–∫–∞ | –°–æ–æ–±—â–µ–Ω–∏–µ | –†–µ—à–µ–Ω–∏–µ |
|--------|-----------|---------|
| –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω | "‚ùå –í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start –¥–ª—è –≤—Ö–æ–¥–∞." | –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start |
| –ù–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤ | "‚ÑπÔ∏è –í —Å–∏—Å—Ç–µ–º–µ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤." | –°–æ–∑–¥–∞–π—Ç–µ –æ–±—ä–µ–∫—Ç—ã –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ |
| –î—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –∑–∞–ø—Ä–æ—Å | "‚ùå –ó–∞–ø—Ä–æ—Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç" | –î–æ–∂–¥–∏—Ç–µ—Å—å —Ä–µ—à–µ–Ω–∏—è –ø–æ –ø–µ—Ä–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É |
| –û—à–∏–±–∫–∞ —Å–µ—Å—Å–∏–∏ | "‚ùå –û—à–∏–±–∫–∞ —Å–µ—Å—Å–∏–∏" | –ù–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ —Å /request-access |

