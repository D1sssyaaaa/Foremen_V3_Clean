# Описание функционала "Табель рабочего времени" (РТБ)

Этот документ описывает, как был спроектирован и должен был работать модуль учета рабочего времени (РТБ) до его удаления из системы.

## 1. Основные сущности

*   **Табель (TimeSheet)**: Документ, фиксирующий отработанное время бригады за определенный период (обычно неделю или месяц). Привязан к Бригаде и Периоду.
*   **Запись табеля (TimeSheetItem)**: Строка, содержащая данные: Работник, Дата, Объект (Cost Object), Отработанные часы.
*   **Статусы**:
    *   `DRAFT` (Черновик): Создается бригадиром, можно редактировать.
    *   `SUBMITTED` (На рассмотрении): Отправлен бригадиром, ожидает проверки менеджера.
    *   `CORRECTED` (Откорректирован): Возвращен на доработку (редкий кейс).
    *   `APPROVED` (Утвержден): Расчитан и принят менеджером, начислены затраты.
    *   `REJECTED` (Отклонен): Полностью отвергнут.

## 2. Ролевая модель и Workflow

### А. Бригадир (Foreman)
1.  **Создание**: Видит кнопку "Создать табель". Выбирает период.
2.  **Заполнение**:
    *   Система автоматически подтягивает состав его бригады.
    *   Для каждого работника и каждого дня бригадир указывает:
        *   Количество часов.
        *   Объект, на котором велись работы (выбор из списка объектов).
3.  **Сохранение**: Может сохранить как `DRAFT` и вернуться позже.
4.  **Отправка**: Нажимает "Отправить". Статус меняется на `SUBMITTED`. Редактирование блокируется.

### Б. Менеджер / HR
1.  **Просмотр списка**: Видит таблицу всех табелей со статусами, фильтрами по статусу и датам.
    *   Колонки: ID, Период, Имя Бригадира, Список Объектов (через запятую), Общие часы, Статус.
2.  **Проверка (Review)**:
    *   Открывает табель в статусе `SUBMITTED`.
    *   Проверяет корректность часов и объектов.
3.  **Утверждение (Approval) и "Умные ставки"**:
    *   Нажимает "Проверить" / "Принять".
    *   Открывается модальное окно калькуляции.
    *   **Ввод ставок**: Менеджер вводит часовую ставку (руб/час).
        *   *Global Rate*: Можно задать одну ставку сразу для всех (напр. 350 р/ч).
        *   *Worker Rate*: Можно задать ставку конкретному работнику, она применится ко всем его дням в этом табеле.
    *   Система автоматически считает `Сумму = Часы * Ставка`.
4.  **Финализация**:
    *   При нажатии "Утвердить", статус меняется на `APPROVED`.
    *   В системе создаются финансовые записи (Actual Costs) по соответствующим Объектам.

## 3. Технические детали реализации (Backend)

*   **API**: `/time-sheets/`
*   **База данных**:
    *   `time_sheets` (таблица заголовков)
    *   `time_sheet_items` (таблица строк)
*   **Интеграции**:
    *   При утверждении вызывался сервис `CostsService` для проводки затрат.
    *   Бригадир получал уведомление (через Telegram Bot) о смене статуса табеля.

## 4. UI (Frontend Layout)
Был реализован табличный вид (Table View):
*   Компактный список табелей.
*   Цветовое кодирование статусов (Серый, Синий, Зеленый, Красный).
*   Модальное окно утверждения с группировкой по работникам (раскрывающиеся списки дней).
